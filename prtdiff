#!/bin/fish
#
# prtdiff - List the difference between installed ports and ports your repos
# onodera, https://github.com/onodera-punpun

## CONFIGURATION

# Set config dir location
set configdir /etc/prtstuff


## EXECUTE

# Load config
source $configdir/config

if test (count $argv) -eq 1
	switch $argv
		case -h --help
			echo -e 'Usage: prtdiff [options]\n'
			echo 'options:'
			echo '  -h,   --help            print help and exit'
			exit 0
		case '*'
			echo 'Invalid option, use -h for help.' >/dev/stderr
			exit 1
	end
end

for port in (prtls -i)
	set name (echo $port | cut -d ' ' -f 1)
	set installed (echo $port | cut -d ' ' -f 2)
	set available (cat $portdir/(prtloc $name)/Pkgfile | string match -r '^version=.*' | cut -d '=' -f 2-)


end
