#!/bin/fish
#
# prtprovide - Search ports for files they provide
# onodera, https://github.com/onodera-punpun

## EXECUTE

if test (count $argv) -ge 1
	for flag in $argv
		switch $flag
			case -h --help
				echo -e 'Usage: prtprovide [query]\n'
				echo 'options:'
				echo '  -h,   --help            print help and exit'
				exit 0
			case '*'
				set results (find /usr/ports -type f -name .footprint | xargs grep -i $argv)

				for line in $results
					echo -n (echo $line | cut -d \t -f 1 | cut -d '.' -f 1 | string replace '/usr/ports' '' | string trim -c '/')
					echo ' '(echo $line | cut -d \t -f 3 | tr ' ' '\n' | sed 's/^/'(set_color black --bold)'->'(set_color normal)' \//g')
				end
		end
	end
else
	echo 'Please specify a query.'
	exit 1
end
